<?
session_start();
?>

<header class="header-nav">
    <svg id="圖層_2" data-name="圖層 2" xmlns="http://www.w3.org/2000/svg" style="height: 70px;" viewBox="0 0 210.51 271.21">
        <defs>
            <style>
                .cls-1 {
                    fill: #f7b044;
                }

                .cls-2 {
                    fill: #827b76;
                }

                .cls-3 {
                    fill: #231815;
                }

                .cls-4 {
                    fill: none;
                    stroke: #231815;
                    stroke-linecap: round;
                    stroke-linejoin: round;
                    stroke-width: 5px;
                }
            </style>
        </defs>
        <path class="cls-1" d="M275.5,209.79a4.85,4.85,0,0,0,1.2,1.15c-11.77,2.08-22-6.48-26.1-15.75a40.22,40.22,0,0,1,5.64-40.78c2.86-3.5,7.3-6.41,11.65-6.94a117.83,117.83,0,0,1,6.79,55.21C274.35,205.11,274,207.82,275.5,209.79Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-2" d="M261.85,66.55a19.18,19.18,0,0,1-6.17,21.37,19.11,19.11,0,0,1,6.14,8.39c-2.45,3.71-7.51,6.08-11.85,7.11a26.79,26.79,0,0,1-32.74-23l-.08-.21a73.44,73.44,0,0,1,16.15-3.73C243.45,75.06,254.4,73.58,261.85,66.55Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-1" d="M209.18,79.72c-7.64,2.22-17.29,5-25.18,4.07s-15.79-5.31-19.08-12.56a22.7,22.7,0,0,1-1.87-9,30.32,30.32,0,0,1,8.06-21.31l.14-.15C185.89,52.52,200.56,65.65,209.18,79.72Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-3" d="M151.58,77.81a2.46,2.46,0,0,1,.35,1.51A3.92,3.92,0,0,1,149,82.61c-2.35.65-3.75-2.26-2.89-4.21S150.45,76.09,151.58,77.81Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-2" d="M142.81,178.35c.94,9.37-1.38,19.29-7.57,26.36s-17.64,10.72-26.52,7.72A97.55,97.55,0,0,1,106,199a76.58,76.58,0,0,1-.36-20.06c1.32-10,5.33-19.46,9.94-28.42.74-1.43,1.51-2.89,2.31-4.3C132.17,149.78,141.38,163.71,142.81,178.35Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-3" d="M105.83,79.43a5.71,5.71,0,0,1-1.32,3.69,9.58,9.58,0,0,1-2.77,2.93,4.21,4.21,0,0,1-3.19.55,26.84,26.84,0,0,1,7-8.07A2.22,2.22,0,0,1,105.83,79.43Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-3" d="M101.4,76.64c1.62.08,3.44.61,4.14,1.89a26.84,26.84,0,0,0-7,8.07,3.28,3.28,0,0,1-.69-.27A3,3,0,0,1,96.12,83a11.86,11.86,0,0,1,1.19-3.78C98.53,77.2,100,76.57,101.4,76.64Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M211.19,83.2q-.94-1.76-2-3.48c-8.62-14.07-23.29-27.2-37.93-38.95-6.46-5.22-12.92-10.15-18.83-14.75a15.21,15.21,0,0,0-5.56-3.21,3.62,3.62,0,0,0-3.34.55,4.19,4.19,0,0,0-1.07,2.47,30.22,30.22,0,0,0,.78,14A30.57,30.57,0,0,0,153,54.84" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M142.85,39.89a25.48,25.48,0,0,0-15.6-9.55,5.25,5.25,0,0,0-2.67,0c-1.66.64-2.35,2.58-2.7,4.32A37.32,37.32,0,0,0,133.37,70" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M128.52,41.88a81.55,81.55,0,0,0,17.1,19.66" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M98.55,86.6a24.8,24.8,0,0,0-2.83,17.54,18.19,18.19,0,0,0,3.67,7.8c3.54,4.22,9.15,6.08,14.56,7.09a70.47,70.47,0,0,0,29.38-.76l.82-.19" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M133.37,70c-6.17,3.62-13.93,2.81-20.76,4.93a23.28,23.28,0,0,0-7.07,3.65" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M97.31,79.26c1.22-2.06,2.67-2.69,4.09-2.62,1.62.08,3.44.61,4.14,1.89a2.22,2.22,0,0,1,.29.9,5.71,5.71,0,0,1-1.32,3.69,9.58,9.58,0,0,1-2.77,2.93,4.21,4.21,0,0,1-3.19.55,3.28,3.28,0,0,1-.69-.27A3,3,0,0,1,96.12,83a11.86,11.86,0,0,1,1.19-3.78" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M151.58,77.81a2.46,2.46,0,0,1,.35,1.51A3.92,3.92,0,0,1,149,82.61c-2.35.65-3.75-2.26-2.89-4.21S150.45,76.09,151.58,77.81Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M217.13,250.57A23.7,23.7,0,0,0,224,254c2.77.83,5.61.25,8.52.25,7.85,0,14.72-5.23,20.14-10.91S262.81,231.12,269.5,227c7.51-4.61,16.4-6.8,25.07-8.26,2.62-.44,5.26-2,4.93-3.67-.28-1.45-2.88-1.41-4.55-1.28a43.51,43.51,0,0,1-14.67-1.35,11.13,11.13,0,0,1-3.58-1.51,4.85,4.85,0,0,1-1.2-1.15c-1.47-2-1.15-4.68-.82-7.11a117.83,117.83,0,0,0-6.79-55.21,110.38,110.38,0,0,0-5.83-13.05" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M114.39,227a72,72,0,0,1-5.67-14.52A97.55,97.55,0,0,1,106,199a76.58,76.58,0,0,1-.36-20.06c1.32-10,5.33-19.46,9.94-28.42.74-1.43,1.51-2.89,2.31-4.3,6.08-10.91,13.72-21.2,24.46-27.39.33-.19.65-.36,1-.53,16.26-8.79,38-6.18,51.63,6.34a28.93,28.93,0,0,1,2.26,2.31c7.76,8.78,10.09,21.54,9.73,33.41-.82,26-7.7,52.92.82,77.53a24.14,24.14,0,0,0,4.95,8.95,28.81,28.81,0,0,0,4.41,3.74" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M114.39,227a66.29,66.29,0,0,1,16.42-3.55,104.13,104.13,0,0,1,32.79,1.72,28.05,28.05,0,0,1,9.86,3.86c2.76,1.89,6.71,6.32,7.17,9.63.42,3.1-.4,8.58-2.23,10.49-8,8.33-23.43,5.6-34.58,2.75s-20.6-10.76-26.83-20.43C116.05,230,115.19,228.48,114.39,227Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M193.65,270.37q-12.42,4.31-24.85,8.58c-7.13,2.45-14.29,4.92-21.75,6a60.13,60.13,0,0,1-24-1.35c-8.45-2.22-16.57-6.46-22.17-13.15s-8.39-16-6-24.42c2-7.25,7.68-13.1,14.29-16.69a43.86,43.86,0,0,1,5.22-2.39" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M193.65,270.37c8,3.39,17.56,10.34,25.38,14.24a41.06,41.06,0,0,0,21.42,4.11c4.76-.38,10.07-2.14,11.87-6.54a10.88,10.88,0,0,0-.25-7.76c-3.1-8.23-13.3-11.69-22.09-12.15s-16.32,1.18-24.64,4.07C201.44,267.68,197.54,269,193.65,270.37Z" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M197.22,126.92c-.65-7.87-.48-19.79,1.8-27.36a34,34,0,0,1,6.57-11.45,24.14,24.14,0,0,1,5.6-4.91,32.14,32.14,0,0,1,6-3,73.44,73.44,0,0,1,16.15-3.73c10.15-1.45,21.1-2.93,28.55-10a19.18,19.18,0,0,1-6.17,21.37,19.11,19.11,0,0,1,6.14,8.39,55.93,55.93,0,0,1,2.67,8.2c1.55,5.94,2.08,11.64,4.42,17.25a7.56,7.56,0,0,1,1,2.68,5.76,5.76,0,0,1-1,3.27,17.79,17.79,0,0,1-7,6.36v0a24.81,24.81,0,0,1-4.76,1.76,35.59,35.59,0,0,1-13.91.86c-.92-.1-1.83-.23-2.75-.4" transform="translate(-91.52 -20.14)" />
        <path class="cls-4" d="M243.22,136.73c3.44,6,1.3,12.46-2,18.54s-8.34,11.06-12.27,16.76c-6.94,10.05-10.53,22.11-12.06,34.22s-2.68,32.07.28,44.3v0" transform="translate(-91.52 -20.14)" />
    </svg><a href="../homepage.php" class="logo">寵愛NEE</a>


    <?php


    echo "<div class='nav-bar'>";
    if (isset($_SESSION['name'])) {
        echo "<a href='../testShop/mall.php' class=''>購物商城</a>";
        echo "<a href='../booking.php' class=''>寵物預約</a>";
        echo "<a href='../reward/index.php' class=''>每日簽到</a>";
        echo "<a href='../news.php' class=''>最新消息</a>";
        echo "<a href='../users-html.php' class=''>會員中心</a>";
    } else {
        echo "<a href='../testShop/mall.php' class=''>購物商城</a>";
        echo "<a href='../booking.php' class=''>寵物預約</a>";
        echo "<a href='../login.php' class=''>每日簽到</a>";
        echo "<a href='../news.php' class=''>最新消息</a>";
        echo "<a href='../login.php' class=''>會員中心</a>";
    }
    echo '</div>';
    ?>


    <!-- 上方紅色顯示 -->
    <div class="icons">
        <div class="fas fa-bars" id="menu-btn"></div>
        <div class="fas fa-search" id="search-btn"></div>
        <div class="fas fa-shopping-cart" id="cart-btn">
            <a id="cart-item" style="color: red;"></a>
        </div>
        <div class="fas fa-user" id="login-btn"></div>
    </div>

    <form id="keyWordForm" action="../testShop/mall.php" method="get" class="search-form">
        <input name="keyword" type="search" id="search-box" placeholder="收尋商品">
        <label onclick="keywordSearch();" for="search-box" class="fas fa-search"></label>
    </form>

    <!-- 購物車右邊 -->
    <div class="shopping-cart">
        <?php
        require '../testShop/config.php'; //引入
        // 抓好$conn(1.mySQL物件及2.語法) 準備執行 
        $stmt = $conn->prepare("SELECT * FROM cart");
        // 執行SQL
        $stmt->execute();
        //1. get_result()使用方法
        $result = $stmt->get_result();
        $grand_total = 0; //總額倉庫
        while ($row = $result->fetch_assoc()) : //fetch_assoc()顯示陣列
        ?>
            <div class="box">
                <div>
                    <a href="../testShop/action.php?remove=<?= $row['cartID'] ?>" class="text-danger lead" onclick="return confirm('確定清除該商品？');"><i class="fa fa-trash" aria-hidden="true"></i></a>
                </div>
                <!-- hidden find才能抓到值 -->
                <img src="../../img/product/200x200/<?= $row['cartimg'] ?>" width="120">
                <div class="content">
                    <input type="hidden" class="r_pid" value="<?= $row['cartID'] ?>">
                    <h3><?= $row['productname'] ?></h3>
                    <span>TWD:
                        &nbsp;&nbsp;<?= number_format($row['productprice'], 0) ?></span>
                    <!-- hidden find才能抓到value -->
                    <input type="hidden" class="pprice r_price" value="<?= $row['productprice'] ?>">
                    <!-- 數量 -->
                    <!-- <span>數量 : <input id="controlNUM" type="number" class="form-control itemQty quantity" value="<?= $row['cqty'] ?>" style="width:75px"> </span> -->
                    <span id="controlNUM" class="r_itemQty quantity">數量 : <?= $row['cqty'] ?> </span>
                </div>
            </div>

            <?php
            //總額計算
            $grand_total += $row['ctotalprice'];
            // echo $grand_total;  //400 700 800 1000..


            ?>
        <?php endwhile; ?>
        <div class="total"> 總價 :
            <td><i class="fa fa-credit-card " aria-hidden="true"></i>
                &nbsp;&nbsp;<?= number_format($grand_total, 0) ?></td>
            <td>
        </div>

        <a href="../testShop/cart.php" class="user-btn">購物車</a>
    </div>

    <!-- 登入 -->
    <form action="" class="btn-login-form">
        <h3><?php if (isset($_SESSION['name'])) echo '歡迎!' . $_SESSION['name'];
            else echo '請先登入'; ?></h3>
        <?php if (isset($_SESSION['name'])) {
            echo "<a href='../users-html.php' class='user-btn'>會員中心</a>";
            echo "<a href='./OrderDetail.php' class='user-btn'>查詢訂單</a>";
            echo "<a href='../SearchBooking.php' class='user-btn'>查詢預約</a>";
            echo "<a href='../logoutC.php' class='user-btn'>登出</a>";
        } else {
            echo "<a href='../login.php' class='user-btn'>會員中心</a>";
            echo "<a href='../login.php' class='user-btn'>查詢訂單</a>";
            echo "<a href='../login.php' class='user-btn'>查詢預約</a>";
            echo "<a href='../login.php' class='user-btn'>登入</a>";
        }
        ?>


    </form>

</header>
<script>
    function keywordSearch() {
        keyWordForm.submit();
    }
</script>